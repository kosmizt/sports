import numpy as np
import pandas as pd
import re

raw_text = """
1Âª rodada
Internacional 2 x 1 Bahia
CriciÃºma 1 x 1 Juventude
Fluminense 2 x 2 Red Bull Bragantino
SÃ£o Paulo 1 x 2 Fortaleza
AtlÃ©tico-GO 1 x 2 Flamengo
Vasco 2 x 1 GrÃªmio
Corinthians 0 x 0 AtlÃ©tico-MG
Athletico-PR 4 x 0 CuiabÃ¡
Cruzeiro 3 x 2 Botafogo
VitÃ³ria 0 x 1 Palmeiras
2Âª rodada
Bahia 2 x 1 Fluminense
GrÃªmio 2 x 0 Athletico-PR
AtlÃ©tico-MG 1 x 1 CriciÃºma
Red Bull Bragantino 2 x 1 Vasco
Fortaleza 1 x 1 Cruzeiro
Juventude 2 x 0 Corinthians
Palmeiras 0 x 1 Internacional
Flamengo 2 x 1 SÃ£o Paulo
Botafogo 1 x 0 AtlÃ©tico-GO
CuiabÃ¡ 0 x 0 VitÃ³ria
3Âª rodada
Fluminense 2 x 1 Vasco
GrÃªmio 1 x 0 CuiabÃ¡
Red Bull Bragantino 1 x 0 Corinthians
AtlÃ©tico-MG 3 x 0 Cruzeiro
VitÃ³ria 2 x 2 Bahia
Palmeiras 0 x 0 Flamengo
Athletico-PR 1 x 0 Internacional
Botafogo 5 x 1 Juventude
AtlÃ©tico-GO 0 x 3 SÃ£o Paulo
CriciÃºma 1 x 1 Fortaleza
4Âª rodada
Vasco 0 x 4 CriciÃºma
CuiabÃ¡ 0 x 3 AtlÃ©tico-MG
Bahia 1 x 0 GrÃªmio
Flamengo 0 x 2 Botafogo
Cruzeiro 3 x 1 VitÃ³ria
Corinthians 3 x 0 Fluminense
Fortaleza 1 x 1 Red Bull Bragantino
Juventude 1 x 1 Athletico-PR
Internacional 1 x 1 AtlÃ©tico-GO
SÃ£o Paulo 0 x 0 Palmeiras
5Âª rodada
Fluminense 2 x 2 AtlÃ©tico-MG
Red Bull Bragantino 1 x 1 Flamengo
Corinthians 0 x 0 Fortaleza
VitÃ³ria 1 x 3 SÃ£o Paulo
Athletico-PR 1 x 0 Vasco
Botafogo 1 x 2 Bahia
CuiabÃ¡ 0 x 2 Palmeiras
Juventude 1 x 0 AtlÃ©tico-GO
Cruzeiro 0 x 0 Internacional
GrÃªmio 1 x 2 CriciÃºma
6Âª rodada
Flamengo 2 x 0 Corinthians
Vasco 2 x 1 VitÃ³ria
AtlÃ©tico-GO 0 x 1 Cruzeiro
Palmeiras 0 x 2 Athletico-PR
Fortaleza 1 x 1 Botafogo
Bahia 1 x 0 Red Bull Bragantino
SÃ£o Paulo 2 x 1 Fluminense
CriciÃºma 2 x 5 CuiabÃ¡
AtlÃ©tico-MG 2 x 1 GrÃªmio
Internacional 2 x 1 Juventude
7Âª rodada
VitÃ³ria 0 x 2 AtlÃ©tico-GO
GrÃªmio 0 x 2 Red Bull Bragantino
CuiabÃ¡ 0 x 1 Internacional
Fluminense 1 x 1 Juventude
Corinthians 0 x 1 Botafogo
Vasco 1 x 6 Flamengo
CriciÃºma 1 x 2 Palmeiras
AtlÃ©tico-MG 1 x 1 Bahia
Fortaleza 1 x 0 Athletico-PR
SÃ£o Paulo 2 x 0 Cruzeiro
8Âª rodada
Juventude 1 x 1 VitÃ³ria
AtlÃ©tico-GO 2 x 2 Corinthians
Botafogo 1 x 0 Fluminense
Red Bull Bragantino 1 x 2 AtlÃ©tico-MG
Cruzeiro 2 x 1 CuiabÃ¡
Athletico-PR 3 x 1 CriciÃºma
Flamengo 2 x 1 GrÃªmio
Internacional 0 x 0 SÃ£o Paulo
Palmeiras 2 x 0 Vasco
Bahia 1 x 0 Fortaleza
9Âª rodada
Red Bull Bragantino 2 x 1 Juventude
Fluminense 1 x 2 AtlÃ©tico-GO
VitÃ³ria 2 x 1 Internacional
Athletico-PR 1 x 1 Flamengo
Corinthians 2 x 2 SÃ£o Paulo
CriciÃºma 2 x 2 Bahia
GrÃªmio 1 x 2 Botafogo
Vasco 0 x 0 Cruzeiro
CuiabÃ¡ 5 x 0 Fortaleza
AtlÃ©tico-MG 0 x 4 Palmeiras
10Âª rodada
Botafogo 1 x 1 Athletico-PR
AtlÃ©tico-GO 1 x 2 CriciÃºma
Fortaleza 1 x 0 GrÃªmio
Juventude 2 x 0 Vasco
SÃ£o Paulo 0 x 1 CuiabÃ¡
Inter 1 x 0 Corinthians
Cruzeiro 2 x 0 Fluminense
VitÃ³ria 4 x 2 AtlÃ©tico-MG
Flamengo 2 x 1 Bahia
Palmeiras 2 x 1 Bragantino
11Âª rodada
CriciÃºma 2 x 1 Botafogo
GrÃªmio 0 x 1 Inter
CuiabÃ¡ 0 x 0 AtlÃ©tico-GO
Vasco 4 x 1 SÃ£o Paulo
Fluminense 0 x 1 Flamengo
Athletico-PR 1 x 1 Corinthians
Bahia 4 x 1 Cruzeiro
Palmeiras 3 x 1 Juventude
Bragantino 2 x 1 VitÃ³ria
AtlÃ©tico-MG 1 x 1 Fortaleza
12Âª rodada
Cruzeiro 2 x 0 Athletico-PR
Botafogo 2 x 1 Bragantino
Corinthians 1 x 1 CuiabÃ¡
Juventude 2 x 1 Flamengo
AtlÃ©tico-GO 1 x 1 GrÃªmio
Bahia 2 x 1 Vasco
Inter 1 x 1 AtlÃ©tico-MG
Fortaleza 3 x 0 Palmeiras
Fluminense 0 x 1 VitÃ³ria
SÃ£o Paulo 2 x 1 CriciÃºma
13Âª rodada
CuiabÃ¡ 1 x 1 Bragantino
Vasco 1 x 1 Botafogo
AtlÃ©tico-MG 1 x 1 AtlÃ©tico-GO
SÃ£o Paulo 3 x 1 Bahia
GrÃªmio 1 x 0 Fluminense
Fortaleza 2 x 1 Juventude
VitÃ³ria 0 x 1 Athletico-PR
Flamengo 2 x 1 Cruzeiro
CriciÃºma 1 x 1 Inter
Palmeiras 2 x 0 Corinthians
14Âª rodada
Bragantino 3 x 1 AtlÃ©tico-GO
CuiabÃ¡ 1 x 2 Botafogo
CriciÃºma 1 x 0 Cruzeiro
Vasco 2 x 0 Fortaleza
Athletico-PR 1 x 2 SÃ£o Paulo
AtlÃ©tico-MG 2 x 4 Flamengo
GrÃªmio 2 x 2 Palmeiras
Bahia 2 x 0 Juventude
Corinthians 3 x 2 VitÃ³ria
Fluminense 1 x 1 Inter
15Âª rodada
Flamengo 1 x 1 CuiabÃ¡
SÃ£o Paulo 2 x 0 Bragantino
Cruzeiro 3 x 0 Corinthians
Juventude 3 x 0 GrÃªmio
Palmeiras 2 x 0 Bahia
Fortaleza 1 x 0 Fluminense
Botafogo 3 x 0 AtlÃ©tico-MG
VitÃ³ria 2 x 1 CriciÃºma
AtlÃ©tico-GO 1 x 2 Athletico-PR
Inter 1 x 2 Vasco
16Âª rodada
GrÃªmio 0 x 2 Cruzeiro
Vasco 2 x 0 Corinthians
Athletico-PR 1 x 3 Bahia
AtlÃ©tico-MG 2 x 1 SÃ£o Paulo
VitÃ³ria 0 x 1 Botafogo
Flamengo 1 x 2 Fortaleza
Palmeiras 3 x 1 AtlÃ©tico-GO
CriciÃºma 1 x 1 Fluminense
CuiabÃ¡ 0 x 0 Juventude
Bragantino 2 x 2 Inter
17Âª rodada
Cruzeiro 2 x 1 Bragantino
Bahia 1 x 2 CuiabÃ¡
Corinthians 2 x 1 CriciÃºma
Juventude 1 x 1 AtlÃ©tico-MG
Botafogo 1 x 0 Palmeiras
SÃ£o Paulo 1 x 0 GrÃªmio
Fortaleza 3 x 1 VitÃ³ria
AtlÃ©tico-GO 0 x 1 Vasco
Inter 1 x 1 Flamengo
Fluminense 1 x 0 Athletico-PR
18Âª rodada
Flamengo 2 x 1 CriciÃºma
Botafogo 1 x 0 Inter
Palmeiras 2 x 0 Cruzeiro
GrÃªmio 2 x 0 VitÃ³ria
AtlÃ©tico-MG 2 x 0 Vasco
Bahia 0 x 1 Corinthians
Bragantino 1 x 0 Athletico-PR
Fortaleza 3 x 1 AtlÃ©tico-GO
CuiabÃ¡ 0 x 1 Fluminense
Juventude 0 x 0 SÃ£o Paulo
19Âª rodada
Cruzeiro 2 x 0 Juventude
VitÃ³ria 1 x 2 Flamengo
SÃ£o Paulo 2 x 2 Botafogo
AtlÃ©tico-GO 1 x 1 Bahia
Fluminense 1 x 0 Palmeiras
Corinthians 2 x 2 GrÃªmio
Inter 2 x 1 Fortaleza
Vasco 1 x 0 CuiabÃ¡
Athletico-PR 1 x 0 AtlÃ©tico-MG
CriciÃºma 1 x 0 Bragantino
20Âª rodada
Palmeiras 0 x 2 VitÃ³ria
Juventude 1 x 2 CriciÃºma
Bahia 1 x 1 Internacional
Botafogo 0 x 3 Cruzeiro
Fortaleza 1 x 0 SÃ£o Paulo
GrÃªmio 1 x 0 Vasco
AtlÃ©tico-MG 2 x 1 Corinthians
Flamengo 2 x 0 AtlÃ©tico-GO
Red Bull Bragantino 0 x 1 Fluminense
CuiabÃ¡ 1 x 2 Athletico-PR
21Âª rodada
VitÃ³ria 1 x 0 CuiabÃ¡
Vasco 2 x 2 Red Bull Bragantino
SÃ£o Paulo 1 x 0 Flamengo
AtlÃ©tico-GO 1 x 4 Botafogo
CriciÃºma 2 x 1 AtlÃ©tico-MG
Corinthians 1 x 1 Juventude
Internacional 1 x 1 Palmeiras
Fluminense 1 x 0 Bahia
Athletico-PR 0 x 2 GrÃªmio
Cruzeiro 1 x 2 Fortaleza
22Âª rodada
Cruzeiro 0 x 0 AtlÃ©tico-MG
Vasco 2 x 0 Fluminense
Corinthians 1 x 1 Red Bull Bragantino
Fortaleza 1 x 0 CriciÃºma
CuiabÃ¡ 1 x 3 GrÃªmio
Juventude 3 x 2 Botafogo
Internacional 2 x 2 Athletico-PR
Bahia 2 x 0 VitÃ³ria
Flamengo 1 x 1 Palmeiras
SÃ£o Paulo 1 x 0 AtlÃ©tico-GO
23Âª rodada
GrÃªmio 0 x 2 Bahia
AtlÃ©tico-MG 1 x 1 CuiabÃ¡
VitÃ³ria 2 x 2 Cruzeiro
Fluminense 0 x 0 Corinthians
Botafogo 4 x 1 Flamengo
Palmeiras 2 x 1 SÃ£o Paulo
Red Bull Bragantino 1 x 2 Fortaleza
Athletico-PR 1 x 2 Juventude
AtlÃ©tico-GO 1 x 0 Internacional
CriciÃºma 2 x 2 Vasco
24Âª rodada
AtlÃ©tico-GO 2 x 1 Juventude
Palmeiras 5 x 0 CuiabÃ¡
AtlÃ©tico-MG 0 x 2 Fluminense
Internacional 1 x 0 Cruzeiro
Bahia 0 x 0 Botafogo
Flamengo 2 x 1 Red Bull Bragantino
SÃ£o Paulo 2 x 1 VitÃ³ria
Fortaleza 1 x 0 Corinthians
CriciÃºma 0 x 1 GrÃªmio
Vasco 2 x 1 Athletico-PR
25Âª rodada
CuiabÃ¡ 2 x 1 CriciÃºma
Botafogo 2 x 0 Fortaleza
GrÃªmio 2 x 3 AtlÃ©tico-MG
Cruzeiro 3 x 1 AtlÃ©tico-GO
VitÃ³ria 0 x 1 Vasco
Fluminense 2 x 0 SÃ£o Paulo
Corinthians 2 x 1 Flamengo
Red Bull Bragantino 2 x 1 Bahia
Athletico-PR 0 x 2 Palmeiras
Juventude 1 x 3 Internacional
26Âª rodada
Internacional 3 x 0 CuiabÃ¡
Cruzeiro 0 x 1 SÃ£o Paulo
Bahia 3 x 0 AtlÃ©tico-MG
Flamengo 1 x 1 Vasco
Botafogo 2 x 1 Corinthians
Palmeiras 5 x 0 CriciÃºma
Red Bull Bragantino 2 x 2 GrÃªmio
Athletico-PR 1 x 1 Fortaleza
AtlÃ©tico-GO 0 x 2 VitÃ³ria
Juventude 2 x 1 Fluminense
27Âª rodada
GrÃªmio 3 x 2 Flamengo
AtlÃ©tico-MG 3 x 0 Red Bull Bragantino
VitÃ³ria 1 x 0 Juventude
Fluminense 0 x 1 Botafogo
Vasco 0 x 1 Palmeiras
Corinthians 3 x 0 AtlÃ©tico-GO
SÃ£o Paulo 1 x 3 Internacional
Fortaleza 4 x 1 Bahia
CuiabÃ¡ 0 x 0 Cruzeiro
CriciÃºma 0 x 0 Athletico-PR
28Âª rodada
Palmeiras 2 x 1 AtlÃ©tico-MG
Botafogo 0 x 0 GrÃªmio
Internacional 3 x 1 VitÃ³ria
Cruzeiro 1 x 1 Vasco
Bahia 1 x 0 CriciÃºma
Flamengo 1 x 0 Athletico-PR
SÃ£o Paulo 3 x 1 Corinthians
Fortaleza 1 x 0 CuiabÃ¡
AtlÃ©tico-GO 1 x 0 Fluminense
Juventude 1 x 1 Red Bull Bragantino
29Âª rodada
GrÃªmio 3 x 1 Fortaleza
AtlÃ©tico-MG 2 x 2 VitÃ³ria
Bahia 0 x 2 Flamengo
Fluminense 1 x 0 Cruzeiro
Vasco 1 x 1 Juventude
Corinthians 2 x 2 Internacional
Red Bull Bragantino 0 x 0 Palmeiras
Athletico-PR 0 x 1 Botafogo
CuiabÃ¡ 2 x 0 SÃ£o Paulo
CriciÃºma 2 x 0 AtlÃ©tico-GO
30Âª rodada
SÃ£o Paulo 3 x 0 Vasco
Fortaleza 1 x 1 AtlÃ©tico-MG
Corinthians 5 x 2 Athletico-PR
Flamengo 0 x 2 Fluminense
AtlÃ©tico-GO 0 x 0 CuiabÃ¡
Botafogo 1 x 1 CriciÃºma
Cruzeiro 1 x 1 Bahia
Internacional 1 x 0 GrÃªmio
VitÃ³ria 1 x 0 Red Bull Bragantino
Juventude 3 x 5 Palmeiras
31Âª rodada
GrÃªmio 3 x 1 AtlÃ©tico-GO
AtlÃ©tico-MG 1 x 3 Internacional
VitÃ³ria 2 x 1 Fluminense
Flamengo 4 x 2 Juventude
Vasco 3 x 2 Bahia
Palmeiras 2 x 2 Fortaleza
Red Bull Bragantino 0 x 1 Botafogo
Athletico-PR 3 x 0 Cruzeiro
CuiabÃ¡ 0 x 1 Corinthians
CriciÃºma 1 x 1 SÃ£o Paulo
32Âª rodada
Internacional 2 x 0 CriciÃºma
Cruzeiro 0 x 1 Flamengo
Bahia 0 x 3 SÃ£o Paulo
Fluminense 2 x 2 GrÃªmio
Botafogo 3 x 0 Vasco
Corinthians 2 x 0 Palmeiras
Red Bull Bragantino 0 x 0 CuiabÃ¡
Athletico-PR 1 x 2 VitÃ³ria
AtlÃ©tico-GO 1 x 0 AtlÃ©tico-MG
Juventude 0 x 3 Fortaleza
33Âª rodada
Internacional 2 x 0 Fluminense
Cruzeiro 2 x 1 CriciÃºma
VitÃ³ria 1 x 2 Corinthians
Flamengo 0 x 0 AtlÃ©tico-MG
Botafogo 0 x 0 CuiabÃ¡
Palmeiras 1 x 0 GrÃªmio
SÃ£o Paulo 2 x 1 Athletico-PR
Fortaleza 3 x 0 Vasco
AtlÃ©tico-GO 0 x 0 Red Bull Bragantino
Juventude 2 x 1 Bahia
34Âª rodada
Corinthians 2 x 1 Cruzeiro
Athletico-PR 2 x 0 AtlÃ©tico-GO
Red Bull Bragantino 1 x 1 SÃ£o Paulo
CriciÃºma 0 x 1 VitÃ³ria
GrÃªmio 2 x 2 Juventude
AtlÃ©tico-MG 0 x 0 Botafogo
Bahia 1 x 2 Palmeiras
CuiabÃ¡ 1 x 2 Flamengo
Fluminense 2 x 2 Fortaleza
Vasco 0 x 1 Internacional
35Âª rodada
Internacional 4 x 1 Red Bull Bragantino
Bahia 1 x 1 Athletico-PR
Botafogo 1 x 1 VitÃ³ria
Corinthians 3 x 1 Vasco
SÃ£o Paulo 2 x 2 AtlÃ©tico-MG
Fortaleza 0 x 0 Flamengo
AtlÃ©tico-GO 0 x 1 Palmeiras
Juventude 1 x 1 CuiabÃ¡
Cruzeiro 1 x 1 GrÃªmio
Fluminense 0 x 0 CriciÃºma
36Âª rodada
GrÃªmio 2 x 1 SÃ£o Paulo
AtlÃ©tico-MG 2 x 3 Juventude
VitÃ³ria 2 x 0 Fortaleza
Flamengo 3 x 2 Internacional
Vasco 2 x 2 AtlÃ©tico-GO
Palmeiras 1 x 3 Botafogo
Red Bull Bragantino 1 x 1 Cruzeiro
Athletico-PR 1 x 1 Fluminense
CuiabÃ¡ 1 x 2 Bahia
CriciÃºma 2 x 4 Corinthians
37Âª rodada
Internacional 0 x 1 Botafogo
Cruzeiro 1 x 2 Palmeiras
VitÃ³ria 1 x 1 GrÃªmio
Fluminense 1 x 0 CuiabÃ¡
Vasco 2 x 0 AtlÃ©tico-MG
Corinthians 3 x 0 Bahia
SÃ£o Paulo 1 x 2 Juventude
Athletico-PR 0 x 1 Red Bull Bragantino
AtlÃ©tico-GO 3 x 1 Fortaleza
CriciÃºma 0 x 3 Flamengo
38Âª rodada
GrÃªmio 0 x 3 Corinthians
AtlÃ©tico-MG 1 x 0 Athletico-PR
Bahia 2 x 0 AtlÃ©tico-GO
Flamengo 2 x 2 VitÃ³ria
Botafogo 2 x 1 SÃ£o Paulo
Palmeiras 0 x 1 Fluminense
Red Bull Bragantino 5 x 1 CriciÃºma
Fortaleza 3 x 0 Internacional
CuiabÃ¡ 1 x 2 Vasco
Juventude 0 x 1 Cruzeiro
"""

rows = []
current_round = None

for line in raw_text.splitlines():
    line = line.strip()
    if not line:
        continue
    m_round = re.match(r"(\d+)[Âªa]* rodada", line)
    if m_round:
        current_round = int(m_round.group(1))
        continue
    m_game = re.match(r"(.+?) (\d+) x (\d+) (.+)", line)
    if m_game:
        time_casa = m_game.group(1).strip()
        gols_casa = int(m_game.group(2))
        gols_fora = int(m_game.group(3))
        time_fora = m_game.group(4).strip()
        if gols_casa > gols_fora:
            resultado = time_casa
        elif gols_fora > gols_casa:
            resultado = time_fora
        else:
            resultado = "Empate"
        rows.append([current_round, time_casa, time_fora, gols_casa, gols_fora, resultado])

df = pd.DataFrame(rows, columns=["rodada", "time_casa", "time_visitante", "gols_casa", "gols_fora", "resultado"])
df.to_csv("brasileirao_2024.csv", index=False, encoding="utf-8-sig")


def get_brasileirao_matches(csv_path="brasileirao_2024.csv"):
    df = pd.read_csv(csv_path)
    df.rename(columns={
        "rodada": "Round",
        "time_casa": "Home",
        "time_visitante": "Away",
        "gols_casa": "hg",
        "gols_fora": "ag"
    }, inplace=True)
    df = df[["Round", "Home", "Away", "hg", "ag"]].sort_values("Round").reset_index(drop=True)
    return df


def update_elo(ratings, home, away, hg, ag, k=30, hfa=100):
    rh, ra = ratings.get(home, 1500), ratings.get(away, 1500)
    expected_h = 1 / (1 + 10 ** ((ra - (rh + hfa)) / 400))
    expected_a = 1 - expected_h

    if hg > ag:
        sh, sa = 1, 0
    elif hg < ag:
        sh, sa = 0, 1
    else:
        sh, sa = 0.5, 0.5

    ratings[home] = rh + k * (sh - expected_h)
    ratings[away] = ra + k * (sa - expected_a)
    return ratings


def compute_elo_by_round(matches):
    ratings = {}
    for _, match in matches.iterrows():
        ratings = update_elo(ratings, match["Home"], match["Away"], match["hg"], match["ag"])
    df = pd.DataFrame(list(ratings.items()), columns=["Team", "Elo"])
    df.sort_values("Elo", ascending=False, inplace=True)
    df.reset_index(drop=True, inplace=True)
    return df


if __name__ == "__main__":
    matches = get_brasileirao_matches()
    elo_table = compute_elo_by_round(matches)
    print("\nðŸ“Š Elo Ratings after latest round:")
    print(elo_table.to_string(index=False, formatters={"Elo": "{:.1f}".format}))

# a terminar: gerar tabela de pontos corridos e comparar a posiÃ§Ã£o com a do ranking de elo. alimentar um csv histÃ³rico (desafio: resolver os times rebaixados)
